## AdWeb 广告管理平台 - 项目开发文档

### 1. 项目概述

**1.1 项目目标**
开发一个基于Web的互联网广告管理平台 (AdWeb)，旨在为广告客户提供购买、管理、监控广告投放的功能，并为平台管理员提供审核、管理的能力。本项目作为软件工程理论与实践课程设计，目标是实践软件工程的基本流程，包括需求分析、设计、实现（部分）和测试。

**1.2 项目范围**
本项目将实现广告管理平台的核心功能，包括：
* 用户（广告主、管理员）管理与认证，广告主注册账号时需要经过审核。
* 广告位管理。
* 广告创建、购买与审核流程。
* 账户充值（模拟支付）与交易历史记录。
* 广告客户对其购买广告的管理（启停、预算调整等）。
* 广告展示数据的基本统计与查询。
* （简化）发票申请功能。
* 提供基础的前台广告展示接口（供模拟调用）。

**1.3 目标用户**
* **广告客户 (Advertiser):** 需要在线投放广告的企业或个人。
* **平台管理员 (Administrator):** 负责平台运营、广告审核、用户管理的人员。

### 2. 需求分析与建模

**2.1 功能需求**

* **FR1: 用户管理与认证 (对应 `Users` App)**
    * FR1.1: 用户注册（邮箱验证，并经过管理员审核后才能激活）。
    * FR1.2: 用户登录/登出。
    * FR1.3: 密码重置。
    * FR1.4: 用户角色区分（广告主、管理员）。
    * FR1.5: 广告主可以查看和编辑自己的基本资料。
    * FR1.6: 管理员可以查看所有用户以及广告信息。
* **FR2: 广告位管理 (对应 `AdPlace` App)**
    * FR2.1: 管理员可以创建、查看、编辑、删除广告位（定义广告位名称、尺寸、类型、基础价格等）。
    * FR2.2: 广告主可以浏览可选的广告位列表及其信息。
* **FR3: 广告活动管理 (对应 `AdManage` App)**
    * FR3.1: 广告主可以创建广告活动（Campaign），设置活动预算、投放时间范围。
    * FR3.2: 广告主可以在活动下创建广告（Ad），选择广告位、上传广告素材（图片/文字）、设置出价（或使用固定价格）、设定投放目标（简化，如时间段）。
    * FR3.3: 广告主提交广告后，广告状态为“待审核”。
    * FR3.4: 广告主可以查看自己创建的广告活动和广告列表及其状态。
    * FR3.5: 广告主可以启动、暂停、编辑（有限编辑，如预算、出价）已审核通过的广告。
    * FR3.6: 广告主可以删除（或归档）不再需要的广告（需考虑状态限制）。
* **FR4: 广告审核 (对应 `AdAudit` App)**
    * FR4.1: 管理员可以查看处于“待审核”状态的广告列表。
    * FR4.2: 管理员可以查看广告详情（素材、目标设置等）。
    * FR4.3: 管理员可以批准或拒绝广告，拒绝时需提供理由。
    * FR4.4: 广告状态根据审核结果更新（“已批准/投放中”或“已拒绝”）。
    * FR4.5: 记录审核历史。
* **FR5: 财务管理 (对应 `Payment` App)**
    * FR5.1: 广告主可以进行账户充值（通过模拟支付接口，例如输入金额确认即可，无需对接真实支付）。
    * FR5.2: 系统记录充值交易历史。
    * FR5.3: 广告主可以查看自己的账户余额和充值历史。
    * FR5.4: 广告投放会消耗账户余额（简化模型：如下单时预扣费或按展示/点击计费，需设计计费逻辑）。
    * FR5.5: 广告主可以申请开具发票（简化流程：记录申请，状态为待处理）。
    * FR5.6: 管理员可以查看（或处理）发票申请（简化）。
* **FR6: 数据统计与展示 (对应 `DataShow` App)**
    * FR6.1: 系统记录广告的基本展示数据（如展示次数、点击次数 - 可以通过模拟接口或定时任务生成模拟数据）。
    * FR6.2: 广告主可以查看自己广告的投放数据（总览和单个广告）。
    * FR6.3: 提供按日期、广告活动、广告等维度的查询功能。
    * FR6.4: 以图表（可选）和表格形式展示数据。
* **FR7: 前台广告接口 (可能在 `AdPlace` 或单独 App)**
    * FR7.1: 提供一个简单的API接口，根据请求参数（如广告位ID）返回一个可投放的广告信息（如素材URL、落地页链接）。此接口供模拟广告在网站上的展示。

**2.2 非功能需求**

* **NFR1: 易用性:** 界面简洁直观，操作流程符合用户习惯。
* **NFR2: 可靠性:** 核心功能（如充值、广告状态变更）数据准确，有一定的错误处理机制。
* **NFR3: 性能:** 常见操作（如列表查询、广告创建）响应时间在可接受范围内（例如2-3秒内）。
* **NFR4: 安全性:** 实现基本的认证和授权，防止未授权访问。密码存储加密。
* **NFR5: 可维护性:** 代码结构清晰，遵循Django项目结构规范，适当添加注释。

**2.3 用户角色**

* **广告主 (Advertiser):** 主要使用广告购买、管理、充值、查看报表等功能。
* **管理员 (Administrator):** 主要使用用户注册审核、广告审核、广告位管理、用户管理、发票管理等功能。

**2.4 场景分析 (Scenario Analysis)**

* **场景1: 广告主购买并投放一个新广告**
    1.  **登录:** 广告主访问平台登录页面 (`Users/login.html`)，输入用户名和密码，点击登录。
    2.  **进入管理后台:** 验证成功后，跳转到广告主的操作后台 (`AdManage/platform_home.html` 或类似的仪表盘页面)。
    3.  **浏览广告位:** 广告主点击“广告位市场”或类似菜单，进入广告位列表页面 (`AdPlace/list.html`)，查看可选的广告位及其价格、尺寸等信息。
    4.  **创建广告活动:** 广告主决定投放后，可能先创建一个广告活动（例如，命名为“春季促销”），设置总预算和时间范围。
    5.  **创建广告:** 在活动下，点击“新建广告”，进入广告创建页面。
    6.  **填写广告信息:** 选择目标广告位，上传广告素材（图片），填写广告名称，设置出价/预算（如果适用），选择投放时段。
    7.  **提交审核:** 填写完毕，点击“提交审核”。系统保存广告信息，状态置为“待审核”。
    8.  **查看状态:** 广告主可以在“我的广告”列表中看到该广告及其“待审核”状态。
    9.  **（后续）审核通过:** 管理员审核通过后，广告状态变为“已批准”。
    10. **（后续）充值与投放:** 如果账户余额充足且在投放时间内，广告状态变为“投放中”，系统开始（模拟）投放并计费。如果余额不足，状态可能为“余额不足”，提示充值。

* **场景2: 管理员审核广告**
    1.  **登录:** 管理员使用管理员账号登录平台。
    2.  **进入审核列表:** 导航至“广告审核”页面 (`AdAudit/...`)，系统显示所有“待审核”的广告列表。
    3.  **选择广告:** 管理员点击某条待审核广告，进入广告详情页面。
    4.  **审查内容:** 管理员查看广告主提交的素材、文字、目标设置等信息，判断是否符合平台规范。
    5.  **做出决定:**
        * **批准:** 点击“批准”按钮。系统更新广告状态为“已批准”。
        * **拒绝:** 点击“拒绝”按钮，可能需要填写拒绝理由。系统更新广告状态为“已拒绝”，并记录理由。
    6.  **处理下一条:** 返回审核列表，处理其他待审核广告。

* **场景3: 广告主查看广告效果报告**
    1.  **登录:** 广告主登录平台。
    2.  **进入报告页面:** 导航至“数据报告”或“效果统计”页面 (`DataShow/...`)。
    3.  **选择范围:** 页面提供筛选条件，如选择时间范围（昨天、近7天、自定义）、选择广告活动或具体广告。
    4.  **查询数据:** 广告主选择条件后点击“查询”。
    5.  **查看结果:** 系统从 `DataShow` App 获取数据，在页面上展示所选范围内的广告效果指标（展示次数、点击次数、花费等），可能包含图表和数据表格。

* **场景4: 管理员审核用户注册**  
    1.  **用户提交注册:**  
        - 用户访问注册页面 (`Users/register.html`)，填写用户名、手机号、邮箱、密码等信息，点击“注册”。  
        - 系统验证基本格式（如邮箱格式、密码强度），通过后保存注册信息，状态置为“待审核”，并通知管理员有新注册待处理（如站内信或邮件）。  
    2.  **管理员登录:**  
        - 管理员使用管理员账号登录平台，进入管理员后台 (`Admin/console.html`)。  
    3.  **进入审核列表:**  
        - 管理员点击“用户管理”→“注册审核”菜单，进入待审核用户列表页面 (`UserAudit/register_list.html`)，页面显示所有状态为“待审核”的用户信息（用户名、注册时间、联系方式等）。  
    4.  **查看用户详情:**  
        - 管理员点击某条待审核用户记录，进入用户详情页面 (`UserAudit/detail.html`)，查看完整注册信息（包括IP地址、设备信息等可选字段），并检查是否存在违规内容（如用户名含敏感词、邮箱/手机号已被注册、信息虚假等）。  
    5.  **做出审核决定:**  
        - **批准:** 点击“批准注册”按钮，系统将用户状态更新为“已批准”，生成用户账号并允许其正常登录平台。  
        - **拒绝:** 点击“拒绝注册”按钮，弹出理由填写框（如“用户名含敏感词”“信息重复”），填写后提交。系统将用户状态更新为“已拒绝”，并通过注册时填写的邮箱/手机号发送拒绝通知（附理由）。  
    6.  **批量处理或筛选:**  
        - 审核列表支持筛选（如按注册时间、用户名搜索）和批量操作（如批量批准符合条件的用户），提高审核效率。  
    7.  **用户状态同步:**  
        - 审核后，用户再次访问登录页面时，若状态为“已批准”则正常登录；若为“已拒绝”，则提示“注册审核未通过，请重新注册或联系客服”。

**2.5 建模 (简化)**

* **用例图 (Conceptual):**
    * **参与者:** 广告主, 管理员
    * **广告主用例:** 管理账户、管理广告活动、管理广告、充值、查看报表、申请发票
    * **管理员用例:** 审核广告、管理广告位、管理用户（可选）、管理发票申请（可选）
* **领域模型 (关键实体及其关系):** (基于你的Django App)
    * `User` (来自 `Users`): 包含 `username`, `email`, `password`, `role` (广告主/管理员), `balance` (广告主余额)。
    * `AdPlacement` (来自 `AdPlace`): 包含 `name`, `size`, `type`, `price`。
    * `Campaign` (可能在 `AdManage`): 包含 `name`, `budget`, `start_date`, `end_date`。`User` (广告主) *拥有* `Campaign`。
    * `Advertisement` (来自 `AdManage`): 包含 `name`, `status` (待审核/已批准/已拒绝/投放中/暂停/已结束), `creative_url`, `target_url`, `bid_price` (或关联价格), `daily_budget` (可选)。`Campaign` *包含* `Advertisement`。`Advertisement` *关联* `AdPlacement`。
    * `AuditLog` (来自 `AdAudit`): 包含 `ad` (关联 `Advertisement`), `admin` (关联 `User`), `action` (批准/拒绝), `reason`, `timestamp`。
    * `Transaction` (来自 `Payment`): 包含 `user` (关联 `User`), `amount`, `type` (充值/扣费), `status` (成功/失败), `timestamp`。
    * `InvoiceRequest` (来自 `Payment` 或新App): 包含 `user`, `amount`, `status` (待处理/已处理), `request_date`。
    * `AdImpression` / `AdClick` (来自 `DataShow`): 包含 `ad` (关联 `Advertisement`), `timestamp`, `cost` (可选)。(用于记录展示/点击数据)

### 3. 设计

**3.1 系统架构设计**

采用 **单体应用 (Monolithic Application) 架构**，基于 **MTV (Model-Template-View)** 设计模式（Django的标准模式）。

* **表现层 (Presentation Layer):**
    * **前端:** 使用HTML、CSS、JavaScript。初期可以利用Django Templates (`*.html` 文件) 实现服务器端渲染。如果需要更丰富的交互，未来可以考虑引入前端框架（如Bootstrap进行快速样式布局，或HTMX/Vue/React进行更复杂的交互）。你的 `templates` 目录下已包含部分页面。
    * **用户界面 (UI):** 见 3.4 节。
* **业务逻辑层 (Business Logic Layer):**
    * **Django Views (`views.py`):** 处理HTTP请求，调用服务或模型方法，准备上下文数据，选择并渲染模板。
    * **Django Forms (`forms.py`):** 处理用户输入验证和表单生成。
    * **Services (`services.py` - 可选):** 对于复杂的业务逻辑，可以将其封装在单独的服务模块中，保持View的简洁。你在 `AdPlace` App中已创建 `services.py`，这是个好实践。
    * **Django Apps:** 将不同功能模块化，如 `Users`, `AdManage`, `AdAudit`, `AdPlace`, `Payment`, `DataShow`。这种划分是合理的。
* **数据访问层 (Data Access Layer):**
    * **Django Models (`models.py`):** 定义数据模型，对应数据库表结构。
    * **Django ORM:** 提供数据库交互的接口，进行CRUD操作。
    * **数据库:** 使用关系型数据库，如 PostgreSQL 或 MySQL（推荐用于后续扩展），开发阶段也可使用 SQLite (`adweb.sql` 可能是你的数据库导出文件或迁移记录）。
* **支撑组件:**
    * **Web服务器:** 开发时使用Django内置服务器，部署时使用 Nginx + Gunicorn/uWSGI。
    * **模拟支付:** 在 `Payment/views.py` 中实现一个简单的逻辑，记录充值成功即可。
    * **模拟广告投放/数据生成:** 可能需要一个简单的脚本或Django管理命令来模拟广告展示/点击，并更新 `DataShow` 相关模型的数据。

**架构图 (简化):**

```
+---------------------+      +-----------------------+      +-----------------+
|      Web Browser    | ---->| Web Server (Nginx)    | ---->| App Server (WSGI)|
+---------------------+      +-----------------------+      +-----------------+
        (HTTP)                      (Proxy Pass)                  | (Python/Django)
                                                                  V
                                     +-------------------------------------------+
                                     |                 Django Application (AdWeb)  |
                                     | +-----------------------------------------+ |
                                     | | URL Routing (urls.py)                   | |
                                     | +-----------------------------------------+ |
                                     | | Middleware                               | |
                                     | +-----------------------------------------+ |
                                     | | Views & Forms (views.py, forms.py)      | |
                                     | |  - Users App Logic                      | |
                                     | |  - AdManage App Logic                   | |
                                     | |  - AdAudit App Logic                    | |
                                     | |  - AdPlace App Logic                    | |
                                     | |  - Payment App Logic                    | |
                                     | |  - DataShow App Logic                   | |
                                     | |  - Services (services.py - optional)    | |
                                     | +-----------------------------------------+ |
                                     | | Templates (HTML, CSS, JS)               | |
                                     | +-----------------------------------------+ |
                                     | | Models & ORM (models.py)                | |
                                     | +-----------------------------------------+ |
                                     +-------------------------------------------+
                                                    | (Database Queries)
                                                    V
                                     +-------------------------------------------+
                                     |             Database (PostgreSQL/MySQL/SQLite)|
                                     +-------------------------------------------+
```

**3.2 数据库设计**

基于领域模型，在各个App的 `models.py` 中定义具体的 Django 模型类。关键模型和字段已在 2.5 节中提及。需要仔细设计模型间的关系（`ForeignKey`, `ManyToManyField`, `OneToOneField`）。

**3.3 接口设计 (API)**

虽然主要是Web应用，但设计一些内部或外部使用的API是有益的。可以采用 **RESTful** 风格。

* **前台广告获取接口 (供模拟网站调用):**
    * `GET /api/adverts/?placement_id=<id>`
        * 请求参数: `placement_id` (广告位ID)
        * 成功响应 (200 OK): `{ "advertisement_id": 123, "creative_url": "...", "target_url": "...", "type": "image" }`
        * 失败响应 (404 Not Found): `{ "error": "No eligible ad found" }`
* **数据上报接口 (供模拟广告展示/点击记录):** (可选，或通过内部逻辑模拟)
    * `POST /api/stats/impression/`
        * 请求体: `{ "advertisement_id": 123, "placement_id": 45 }`
        * 响应 (201 Created): `{ "status": "recorded" }`
    * `POST /api/stats/click/`
        * 请求体: `{ "advertisement_id": 123, "placement_id": 45 }`
        * 响应 (201 Created): `{ "status": "recorded" }`
* **内部或未来前后端分离可能使用的API (示例):**
    * `GET /api/advertiser/ads/`: 获取当前登录广告主的所有广告。
    * `POST /api/advertiser/ads/`: 创建新广告。
    * `GET /api/admin/ads/pending/`: 获取待审核广告列表。
    * `POST /api/admin/ads/<ad_id>/approve/`: 批准广告。
    * `POST /api/advertiser/recharge/`: (模拟)发起充值。

目前项目以Django Templates为主，这些API可以暂缓或仅实现最核心的部分 (如FR7.1)。

**3.4 用户界面 (UI) 设计 (关键页面描述)**

基于现有 `templates` 和需求，规划关键页面：

1.  **公共页面:**
    * `Users/login.html`: 登录表单。
    * `Users/register.html`: 注册表单。
    * `Users/password_reset_*.html`: 密码重置流程页面。
    * `Users/home.html`: 可能是未登录用户的首页或通用导航框架页。
2.  **广告主界面:**
    * **仪表盘 (Dashboard):** (例如 `AdManage/platform_home.html` 改造) 显示账户余额、进行中的广告活动数、昨日消耗、关键指标概览图表。
    * **广告活动管理页:** 列表显示所有广告活动，可创建新活动，点击进入活动详情。
    * **广告管理页:** (可能按活动分组) 列表显示广告（名称、状态、预算、投放时间、关键数据），提供创建、编辑、启停、删除按钮。
    * **广告创建/编辑页:** 表单，包含活动选择、广告名称、广告位选择、素材上传、出价、投放设置等字段。
    * **广告位市场页 (`AdPlace/list.html`):** 展示所有可用广告位卡片或列表，包含名称、尺寸、类型、价格等信息。
    * **财务中心页:**
        * **充值页:** 输入充值金额的表单，模拟支付按钮。
        * **交易记录页:** 表格显示充值和扣费历史。
        * **发票管理页:** 申请发票的表单，显示历史申请记录。
    * **数据报告页 (`DataShow/...`):** 提供日期、活动/广告筛选器，下方用图表和表格展示展示量、点击量、花费等数据。
    * **账户设置页 (`Users/profile.html`):** 修改个人信息、密码。
3.  **管理员界面:**
    * **管理员仪表盘:** 显示待审核广告数、平台概览数据等。
    * **广告审核列表页 (`AdAudit/...`):** 表格显示待审核广告，包含广告主、提交时间、广告名称等，提供“审核”按钮。
    * **广告审核详情页:** 显示广告详细信息（素材预览、设置等），提供“批准”和“拒绝”（带理由输入框）按钮。
    * **广告位管理页 (`AdPlace/list.html` 的管理员版本):** 列表显示所有广告位，提供创建、编辑、删除按钮。
    * **广告位创建/编辑页 (`AdPlace/create.html`):** 表单，用于输入广告位信息。
    * **用户管理页 (可选):** 列表显示用户信息。
    * **发票管理页 (可选):** 列表显示发票申请，提供处理状态更新功能。

**UI风格建议:** 使用简洁、专业的风格。可以引入一个CSS框架（如Bootstrap）来快速搭建布局和组件，统一视觉效果。

### 4. 当前状态与后续步骤

**4.1 当前状态**
* 项目结构已搭建，使用Django框架。
* 已创建 `Users`, `AdManage`, `AdAudit`, `AdPlace`, `Payment`, `DataShow` 等App。
* `Users` App 实现了基本的注册、登录、认证、密码重置功能，并有对应的模板。
* `AdPlace` App 有创建和列表展示广告位的基础模板和视图逻辑。
* `AdManage` App 有一个平台首页模板。
* 其他 App (`AdAudit`, `Payment`, `DataShow`) 已创建但可能功能尚未实现。
* 已有基础的 `models.py` 定义，但可能需要根据详细设计进行完善。
* `adweb.sql` 文件存在，可能是数据库结构快照或数据。

**4.2 后续开发步骤 (建议)**

1.  **完善模型:** 根据领域模型设计，仔细检查并完善所有 App 中的 `models.py`，定义好字段和关系。运行 `python manage.py makemigrations` 和 `python manage.py migrate` 更新数据库结构。
2.  **实现核心业务逻辑 - 后端:**
    * **广告管理 (`AdManage`):** 实现广告活动和广告的CRUD视图和逻辑，处理状态转换。
    * **广告审核 (`AdAudit`):** 实现管理员查看待审核列表、审核详情、批准/拒绝广告的视图和逻辑。
    * **支付与财务 (`Payment`):** 实现模拟充值逻辑、记录交易、计算余额、处理发票申请（简化）。
    * **广告位管理 (`AdPlace`):** 完善管理员对广告位的CRUD操作。
    * **数据记录/统计 (`DataShow`):** 设计如何记录广告展示/点击数据（初期可手动添加或写脚本模拟），并提供查询接口给前端。
3.  **实现核心业务逻辑 - 前端 (Django Templates):**
    * 根据 UI 设计，创建或完善各个功能的 HTML 模板。
    * 使用 Django Template Language 将后端数据渲染到页面上。
    * 使用 Django Forms 处理表单提交和验证。
    * 引入基础的 CSS (如 `style.css` 或 Bootstrap) 美化界面。
4.  **实现广告接口 (`FR7.1`):** 开发简单的API View 返回广告信息。
5.  **测试:** 对核心功能进行单元测试（`tests.py`）和手动测试。
6.  **文档:** 撰写用户手册（如果需要）和完善开发文档。

**优先级建议:** 优先完成广告主创建广告 -> 管理员审核广告 -> 广告主查看广告列表和状态 -> 模拟充值与余额显示 -> 广告投放状态变更（基于审核和余额）-> 基本数据展示。

### 5. 技术栈总结

* **后端:** Python 3.10, Django
* **数据库:** PostgreSQL / MySQL / SQLite (根据你的 `adweb.sql` 和偏好选择)
* **前端:** HTML, CSS, JavaScript (初期以 Django Templates 为主)
* **Web服务器 (部署):** Nginx + Gunicorn / uWSGI
* **版本控制:** Git