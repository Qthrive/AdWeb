# 互联网广告平台详细需求文档

## 一、功能需求

### （一）广告购买与审核
#### 1. 广告套餐展示
- **界面设计**：采用卡片式布局展示套餐，每张卡片包含：
  - 广告形式图标（横幅/弹窗/信息流）
  - 基础价格（按CPM/CPC/CPA显示）
  - 可投放位置标签（首页轮播位/文章页底部等）
  - 预估曝光量范围（如10万-50万次/日）
- **筛选器**：
  - 价格区间滑块（0-10000元）
  - 投放位置多选框（支持三级分类选择）
  - 排序方式（价格/曝光量/CTR优先）
  - 搜索框支持关键词联想（输入"首页"时自动匹配相关位置）

#### 2. 广告购买流程
- **四步向导式表单**：
  1. 选择投放周期（日期选择器支持节假日标注）
  2. 设置定向条件：
     - 地域：省/市/区三级联动选择
     - 设备类型：移动端/PC端/平板
     - 兴趣标签：三级标签体系（如：科技>手机>安卓用户）
  3. 素材上传：
     - 图片：支持JPG/PNG，自动检测尺寸是否符合规范（如728x90）
     - 视频：MP4格式，自动转码并生成预览图
     - 落地页URL：实时验证有效性
  4. 订单确认页：
     - 显示费用计算公式（基础价×预估曝光量×定向系数）
     - 显示法律声明弹窗（需勾选确认）

#### 3. 审核流程
- **自动化初审**：
  - 文本内容：敏感词库过滤（含6000+违规关键词）
  - 图片检测：调用第三方AI接口检测涉黄/暴恐内容
  - 落地页快照：自动抓取首屏内容存档
- **人工审核界面**：
  - 并列显示原始素材与合规要求对照表
  - 驳回时必须选择预定义违规类型（虚假宣传/侵权/资质不全等）
  - 批注功能：可在素材截图上直接标注问题区域
- **审核时效**：普通审核（24小时内）/加急审核（2小时内，加收15%费用）

### （二）模拟支付系统
#### 1. 支付流程
- **支付网关模拟**：
  - 银行卡支付：生成虚拟卡号（622576******3578）
  - 支付宝/微信：显示模拟二维码（带倒计时60秒）
- **支付结果页**：
  - 成功：显示电子回单（含18位支付流水号）
  - 失败：显示错误代码表（如：BAL_001=余额不足）
- **对账机制**：每日凌晨2点自动核对支付订单与财务系统

#### 2. 充值记录
- **数据表格**：
  - 列定义：交易时间（精确到秒）| 金额（保留两位小数）| 支付渠道图标
  - 操作列：电子回单下载 | 申请退款（仅限支付后24小时内）
- **异常处理**：
  - 超时未支付订单自动关闭（30分钟后）
  - 重复订单检测（同一用户10分钟内相同金额订单预警）

### （三）广告管理
#### 1. 广告控制面板
- **状态指示灯系统**：
  - 绿色：投放中（显示剩余预算百分比）
  - 黄色：审核中（显示预计完成时间）
  - 灰色：已暂停（显示暂停原因标签）
- **快速操作区**：
  - 批量启动/暂停按钮
  - 预算告警设置（当消耗达80%时触发邮件通知）

#### 2. 数据报告
- **基础数据看板**：
  - 实时指标：当前在线人数 | 当前曝光速率（次/秒）
  - 趋势图：小时级数据曲线（可切换展示量/点击量）
- **深度分析**：
  - 受众分析：性别/年龄分布环形图
  - 地域热力图（基于IP定位）
  - 设备分析：操作系统/浏览器版本分布

### （四）开发者接口
#### 1. 展示接口
- **JS SDK**：
  ```javascript
  adPlatform.init({
    container: '#ad-div',
    adUnitId: 'HOME_BANNER_001',
    autoRefresh: 30, // 秒
    onError: (code) => console.log('Error:', code)
  });
  ```
- **响应格式**：
  ```json
  {
    "creative": {
      "type": "image",
      "url": "https://cdn.example.com/ad123.jpg",
      "clickUrl": "https://track.example.com/click?id=123"
    },
    "impressionId": "IMP_20230901_001"
  }
  ```

#### 2. 数据接口
- **统计查询API**：
  ```
  GET /api/v1/stats?start=2023-09-01&end=2023-09-07&granularity=daily
  Response:
  [
    {
      "date": "2023-09-01",
      "impressions": 15000,
      "clicks": 320,
      "ctr": 2.13%
    },
    ...
  ]
  ```

### （五）发票系统
#### 1. 电子发票
- **生成流程**：
  1. 调用税控系统API生成PDF
  2. 自动加盖电子签章
  3. 发送至客户邮箱（带密码保护）
- **发票查验**：集成国家税务总局查验接口

#### 2. 纸质发票
- **物流跟踪**：
  - 对接快递100API显示实时物流信息
  - 签收后自动更新状态为"已完成"

## 二、非功能需求

### （一）性能指标
- **系统容量**：
  - 支持5000+并发购买请求
  - 每秒处理1000+广告展示请求
- **响应时间**：
  - 核心交易接口：TPS≥500，99%请求<1.5s
  - 数据查询接口：复杂查询<5s，简单查询<1s

### （二）安全机制
- **数据加密**：
  - 传输层：TLS 1.3强制加密
  - 存储层：敏感字段AES-256加密
- **风控规则**：
  - 同一IP每分钟最多提交5次支付请求
  - 单日充值金额超过10万元触发人工审核

### （三）兼容性矩阵
| 浏览器      | 版本要求 | 渲染引擎 |
|-------------|----------|----------|
| Chrome      | 90+      | Blink    |
| Safari      | 14+      | WebKit   |
| Firefox     | 85+      | Gecko    |
| Edge        | 91+      | Blink    |

| 设备类型   | 分辨率适配范围       |
|------------|----------------------|
| 手机       | 320px - 1440px       |
| 平板       | 768px - 2048px       |
| PC         | 1024px - 3840px      |

## 三、异常处理流程

### 1. 支付超时
- 倒计时结束后自动释放广告位
- 向客户发送包含订单恢复链接的短信

### 2. 审核驳回
- 触发三步处理流程：
  1. 站内信推送（带驳回详情）
  2. 邮件通知（含修改建议文档链接）
  3. 客服外呼（针对高价值客户）

### 3. 数据异常
- 当CTR突增300%时：
  1. 自动暂停广告投放
  2. 触发反作弊检测（IP分析/用户行为分析）
  3. 生成异常报告并通知客户

## 四、数据字典示例

| 表名         | 字段名          | 数据类型    | 约束条件               |
|--------------|-----------------|-------------|------------------------|
| ad_orders    | targeting_rules | JSON        | 验证JSON Schema        |
| creatives    | file_hash       | CHAR(64)    | SHA-256算法            |
| transactions | channel         | ENUM('ALI','WX','CARD') | 默认'CARD'        |
| invoices     | tax_id          | VARCHAR(20) | 正则校验^[A-Z0-9]{10,20}$ |

## 五、界面原型示例
1. 广告购买页面：https://example.com/mockups/ad-buy
2. 数据看板：https://example.com/mockups/dashboard
3. 接口调试工具：https://example.com/api-explorer

（注：实际文档应包含完整的流程图、ER图、状态转换图等技术附件）