以下是对广告系统的类分析和数据流图分析：

### 一、类分析（Class Diagram）

#### 1. 用户模块类
```mermaid
classDiagram
    class User {
        -userId: int
        -email: string
        -password: string
        -role: string (普通用户/管理员)
        -balance: decimal
        +register()
        +login()
        +updateProfile()
        +changePassword()
    }

    class VerificationCode {
        -codeId: int
        -email: string
        -code: string
        -expireTime: datetime
        +generateCode()
        +validateCode()
    }

    class AuthService {
        +sendVerificationEmail()
        +validateCredentials()
        +checkPermission()
    }
```

#### 2. 广告投放模块类
```mermaid
classDiagram
    class Ad {
        -adId: int
        -advertiserId: int
        -placementType: string (横幅/弹窗/信息流)
        -budget: decimal
        -dailyLimit: decimal
        -imageURL: string
        -startDate: date
        -endDate: date
        -status: string (待审核/投放中/已结束)
        +validateImageFormat()
        +calculateRemainingBudget()
    }

    class AdPlacement {
        -placementId: int
        -placementType: string
        -dimension: string
        -pricePerDay: decimal
        +getAvailablePlacements()
    }

    class AdService {
        +createAd()
        +updateAdStatus()
        +getAdList()
        +validateAdTimeRange()
    }
```

#### 3. 审核模块类
```mermaid
classDiagram
    class Review {
        -reviewId: int
        -adId: int
        -reviewerId: int
        -status: string (通过/驳回)
        -comment: string
        -reviewTime: datetime
        +recordReviewResult()
    }

    class ReviewService {
        +getPendingAds()
        +processReview()
        +getReviewHistory()
    }
```

#### 4. 支付模块类
```mermaid
classDiagram
    class Account {
        -accountId: int
        -userId: int
        -balance: decimal
        +deposit()
        +deductBalance()
        +getBalance()
    }

    class Transaction {
        -txnId: int
        -userId: int
        -amount: decimal
        -type: string (充值/消费)
        -txnTime: datetime
        +recordTransaction()
    }

    class PaymentService {
        +processPayment()
        +generatePaymentPage()
        +getTransactionHistory()
    }
```

#### 5. 数据统计模块类
```mermaid
classDiagram
    class AdStats {
        -statsId: int
        -adId: int
        -impressions: int
        -clicks: int
        -spend: decimal
        -date: date
        +generateMockData()
    }

    class StatsService {
        +getAdPerformance()
        +generateChartData()
        +calculateROI()
    }
```

### 二、数据流图（Data Flow Diagram）

```mermaid
flowchart TD
    subgraph 用户端
    A[用户注册/登录] --> B{邮箱验证}
    B --> C[个人中心]
    C --> D[修改资料/密码]
    A --> E[广告主工作台]
    E --> F[创建广告]
    E --> G[查看广告列表]
    E --> H[充值账户]
    E --> I[查看数据统计]
    end

    subgraph 后端服务
    F --> J[广告校验服务]
    J --> K[广告存储]
    K --> L[审核队列]
    L --> M[管理员审核]
    M --> N[更新广告状态]
    N --> G

    H --> O[支付网关]
    O --> P[账户余额更新]
    P --> Q[生成交易记录]

    I --> R[数据统计服务]
    R --> S[生成模拟数据]
    S --> T[图表展示]
    end

    subgraph 数据库
    K --> UserDB[(用户表)]
    K --> AdDB[(广告表)]
    L --> ReviewDB[(审核记录表)]
    P --> AccountDB[(账户表)]
    Q --> TransactionDB[(交易记录表)]
    S --> StatsDB[(统计表)]
    end
```

### 三、关键交互流程

1. **广告审核流程**
```mermaid
sequenceDiagram
    participant Advertiser
    participant AdService
    participant ReviewService
    participant Admin

    Advertiser->>AdService: 提交广告
    AdService->>AdDB: 保存广告数据
    AdService->>ReviewService: 加入审核队列
    ReviewService->>Admin: 通知审核
    Admin->>ReviewService: 执行审核
    ReviewService->>AdService: 更新广告状态
    AdService->>AdDB: 修改广告状态
    AdService->>Advertiser: 通知审核结果
```

2. **支付充值流程**
```mermaid
sequenceDiagram
    participant User
    participant PaymentService
    participant AccountService
    participant TransactionDB

    User->>PaymentService: 发起充值
    PaymentService->>PaymentGateway: 调用支付接口
    PaymentGateway-->>PaymentService: 返回支付结果
    PaymentService->>AccountService: 更新账户余额
    AccountService->>AccountDB: 保存新余额
    AccountService->>TransactionDB: 记录交易
    PaymentService->>User: 显示充值结果
```

### 四、数据库关系图
```mermaid
erDiagram
    User ||--o{ Ad : 创建
    User ||--|| Account : 拥有
    Ad ||--o{ Review : 需要审核
    Ad ||--o{ Transaction : 消费
    Ad ||--o{ AdStats : 产生统计
    Account ||--o{ Transaction : 记录
```

### 五、核心设计要点
1. **权限控制**：通过Role-Based Access Control（RBAC）实现不同角色的访问权限
2. **状态机设计**：广告状态迁移（待审核→投放中→已结束）
3. **数据一致性**：使用数据库事务保证充值操作中账户余额和交易记录的一致性
4. **数据模拟**：通过定时任务生成模拟曝光/点击数据
5. **文件存储**：广告图片使用对象存储服务（如AWS S3），数据库保存URL路径

该设计实现了模块间的松耦合，通过服务层进行业务逻辑封装，数据库采用规范化的表结构设计，同时通过数据流图清晰地展示了系统各组件间的交互关系。